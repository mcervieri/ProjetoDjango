{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard | FitApp{% endblock %}
{% block page_title %}Dashboard do Aluno{% endblock %}

{% block content %}
<div class="row">
  <div class="col-lg-12">
    <div class="card card-neon shadow-lg">
      <div class="card-header neon-header">
        <h3 class="card-title text-neon">
          <i class="fas fa-bolt"></i> Bem-vindo(a), {{ user.first_name|default:user.username }}
        </h3>
      </div>
      <div class="card-body text-light">
        <p class="mb-0 text-muted">
          Aqui você pode acompanhar seu progresso, treinos e planos nutricionais personalizados.
        </p>
      </div>
    </div>
  </div>
</div>

<!-- === MÉTRICAS === -->
<div class="row mt-4">
  <div class="col-lg-3 col-6">
    <div class="small-box neon-box">
      <div class="inner">
        <h3 class="count" data-target="5">0</h3>
        <p>Treinos Ativos</p>
      </div>
      <div class="icon"><i class="fas fa-dumbbell"></i></div>
      <a href="#" class="small-box-footer">Ver treinos <i class="fas fa-arrow-circle-right"></i></a>
    </div>
  </div>

  <div class="col-lg-3 col-6">
    <div class="small-box neon-box">
      <div class="inner">
        <h3 class="count" data-target="3">0</h3>
        <p>Planos Nutricionais</p>
      </div>
      <div class="icon"><i class="fas fa-apple-alt"></i></div>
      <a href="#" class="small-box-footer">Ver planos <i class="fas fa-arrow-circle-right"></i></a>
    </div>
  </div>

  <div class="col-lg-3 col-6">
    <div class="small-box neon-box">
      <div class="inner">
        <h3 class="count" data-target="2">0</h3>
        <p>Metas Atingidas</p>
      </div>
      <div class="icon"><i class="fas fa-trophy"></i></div>
      <a href="#" class="small-box-footer">Ver detalhes <i class="fas fa-arrow-circle-right"></i></a>
    </div>
  </div>

  <div class="col-lg-3 col-6">
    <div class="small-box neon-box">
      <div class="inner">
        <h3 class="count" data-target="7">0</h3>
        <p>Dias de Treino no Mês</p>
      </div>
      <div class="icon"><i class="fas fa-calendar-alt"></i></div>
      <a href="#" class="small-box-footer">Ver histórico <i class="fas fa-arrow-circle-right"></i></a>
    </div>
  </div>
</div>

<!-- === PROFISSIONAIS ASSOCIADOS === -->
<div class="row mt-4">
  <div class="col-lg-6">
    <div class="card card-neon shadow">
      <div class="card-header neon-header">
        <h3 class="card-title text-neon"><i class="fas fa-apple-alt"></i> Seu Nutricionista</h3>
      </div>
      <div class="card-body text-light">
        {% if user.profile.nutricionista %}
          <p>Você está acompanhado por <strong>{{ user.profile.nutricionista.user.first_name|default:user.profile.nutricionista.user.username }}</strong>.</p>
          <a href="#" class="btn btn-neon btn-sm">Ver plano alimentar</a>
        {% else %}
          <p class="text-muted">Nenhum nutricionista associado no momento.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-lg-6">
    <div class="card card-neon shadow">
      <div class="card-header neon-header">
        <h3 class="card-title text-neon"><i class="fas fa-dumbbell"></i> Seu Personal Trainer</h3>
      </div>
      <div class="card-body text-light">
        {% if user.profile.personal %}
          <p>Você treina com <strong>{{ user.profile.personal.user.first_name|default:user.profile.personal.user.username }}</strong>.</p>
          <a href="#" class="btn btn-neon btn-sm">Ver plano de treino</a>
        {% else %}
          <p class="text-muted">Nenhum personal trainer associado no momento.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- === BOTÃO PARA PERFIL COMPLETO === -->
<div class="text-center mt-5">
  <a href="{% url 'profile:aluno_profile' %}" class="btn btn-neon btn-lg px-5 py-2">
    <i class="fas fa-user-circle"></i> Ver meu perfil completo
  </a>
</div>

<!-- === ANIMAÇÃO DE CONTADORES === -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const counters = document.querySelectorAll(".count");
  const speed = 100;

  counters.forEach(counter => {
    const updateCount = () => {
      const target = +counter.getAttribute("data-target");
      const count = +counter.innerText;
      const increment = target / speed;

      if (count < target) {
        counter.innerText = Math.ceil(count + increment);
        requestAnimationFrame(updateCount);
      } else {
        counter.innerText = target;
      }
    };

    counter.style.opacity = "0";
    counter.style.transform = "translateY(10px)";
    setTimeout(() => {
      counter.style.transition = "all 0.6s ease";
      counter.style.opacity = "1";
      counter.style.transform = "translateY(0)";
      updateCount();
    }, 300);
  });
});
</script>

{% endblock %}
